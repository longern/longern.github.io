(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{298:function(e,t,n){var r=n(323);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n(47).default)("0c98f11a",r,!0,{})},304:function(e,t,n){"use strict";var r={};e.exports=function(e){if("undefined"==typeof window)return null;var t=window.OfflineAudioContext||window.webkitOfflineAudioContext,n=window.AudioContext||window.webkitAudioContext;if(!n)return null;"number"==typeof e&&(e={sampleRate:e});var a=e&&e.sampleRate;if(e&&e.offline)return t?new t(e.channels||2,e.length,a||44100):null;var o=r[a];if(o)return o;try{o=new n(e)}catch(e){o=new n}return r[o.sampleRate]=r[a]=o,o}},314:function(e,t,n){"use strict";const r=n(304),a=n(315);e.exports=function e(t,n,o){n instanceof Function&&(o=n,n={});n||(n={});let s=n.context||r();t instanceof Blob&&(t=new File([t],"decode"));if(t instanceof File)return new Promise((r,a)=>{try{let s=new FileReader;s.readAsArrayBuffer(t),s.onload=(()=>r(e(s.result,n,o)))}catch(e){a(e)}});t instanceof ArrayBuffer||(t=a(t));return s.decodeAudioData(t.slice(),e=>{o&&o(null,e)},e=>{o&&o(e)})}},315:function(e,t,n){"use strict";var r=n(316),a=n(319);e.exports=function e(t){if(!t)return new ArrayBuffer;if(t instanceof ArrayBuffer)return t;if("string"==typeof t)return r(t);if(ArrayBuffer.isView(t))return null!=t.byteOffset?t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength):t.buffer;if(t.buffer||t.data||t._data)return e(t.buffer||t.data||t._data);if(null!=t.length)for(var n=0;n<t.length;n++)if(null!=t[n].length){t=a(t);break}return new Uint8Array(null!=t.length?t:[t]).buffer}},316:function(e,t,n){"use strict";var r=n(317),a=n(318);function o(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer}e.exports=function(e){if("string"!=typeof e)throw Error("Argument should be a string");return/^data\:/i.test(e)?function(e){var t=(e=e.replace(/\r?\n/g,"")).indexOf(",");if(-1===t||t<=4)throw new TypeError("malformed data-URI");for(var n=e.substring(5,t).split(";"),a=!1,s="US-ASCII",i=0;i<n.length;i++)"base64"==n[i]?a=!0:0==n[i].indexOf("charset=")&&(s=n[i].substring(8));var f=unescape(e.substring(t+1));a&&(f=r(f));var u=o(f);return u.type=n[0]||"text/plain",u.charset=s,u}(e):(a(e)&&(e=r(e)),o(e))}},317:function(e,t){e.exports=function(e){return atob(e)}},318:function(e,t,n){!function(n){"use strict";function r(e,t){if(e instanceof Boolean||"boolean"==typeof e)return!1;if(t instanceof Object||(t={}),t.hasOwnProperty("allowBlank")&&!t.allowBlank&&""===e)return!1;var n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return t.mime&&(n="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?"+n),!1===t.paddingRequired&&(n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+n+"$","gi").test(e)}e.exports&&(t=e.exports=r),t.isBase64=r}()},319:function(e,t,n){var r=n(320);e.exports=function(e,t,n){if(!e)throw new TypeError("must specify data as first parameter");if(n=0|+(n||0),Array.isArray(e)&&e[0]&&"number"==typeof e[0][0]){var a,o,s,i,f=e[0].length,u=e.length*f;t&&"string"!=typeof t||(t=new(r(t||"float32"))(u+n));var l=t.length-n;if(u!==l)throw new Error("source length "+u+" ("+f+"x"+e.length+") does not match destination length "+l);for(a=0,s=n;a<e.length;a++)for(o=0;o<f;o++)t[s++]=null===e[a][o]?NaN:e[a][o]}else if(t&&"string"!=typeof t)t.set(e,n);else{var c=r(t||"float32");if(Array.isArray(e)||"array"===t)for(t=new c(e.length+n),a=0,s=n,i=t.length;s<i;s++,a++)t[s]=null===e[a]?NaN:e[a];else 0===n?t=new c(e):(t=new c(e.length+n)).set(e,n)}return t}},320:function(e,t){e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},321:function(e,t){function n(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}e.exports=function(e,t){t=t||{};var r,a=e.numberOfChannels,o=e.sampleRate,s=t.float32?3:1,i=3===s?32:16;r=2===a?function(e,t){var n=e.length+t.length,r=new Float32Array(n),a=0,o=0;for(;a<n;)r[a++]=e[o],r[a++]=t[o],o++;return r}(e.getChannelData(0),e.getChannelData(1)):e.getChannelData(0);return function(e,t,r,a,o){var s=o/8,i=a*s,f=new ArrayBuffer(44+e.length*s),u=new DataView(f);n(u,0,"RIFF"),u.setUint32(4,36+e.length*s,!0),n(u,8,"WAVE"),n(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,t,!0),u.setUint16(22,a,!0),u.setUint32(24,r,!0),u.setUint32(28,r*i,!0),u.setUint16(32,i,!0),u.setUint16(34,o,!0),n(u,36,"data"),u.setUint32(40,e.length*s,!0),1===t?function(e,t,n){for(var r=0;r<n.length;r++,t+=2){var a=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,a<0?32768*a:32767*a,!0)}}(u,44,e):function(e,t,n){for(var r=0;r<n.length;r++,t+=4)e.setFloat32(t,n[r],!0)}(u,44,e);return f}(r,s,o,a,i)}},322:function(e,t,n){"use strict";var r=n(298);n.n(r).a},323:function(e,t,n){(e.exports=n(46)(!1)).push([e.i,".hourglass .el-row{margin-bottom:16px}",""])},331:function(e,t,n){"use strict";n.r(t);n(290),n(39);var r=n(293),a=n.n(r),o=(n(307),n(308),n(65),n(5)),s=n.n(o),i=n(314),f=n(321),u={name:"Hourglass",data:function(){return{model:null,decodeContext:n(304)({sampleRate:22050,offline:!0,length:1}),progress:0}},created:function(){var e=s()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tf.loadModel("models/hourglass/model.json");case 2:this.model=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{handleFileChange:function(){var e=s()(regeneratorRuntime.mark(function e(){var t,n,r,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$refs.uploader.files.length){e.next=2;break}return e.abrupt("return");case 2:return t=this.$refs.uploader.files[0],e.next=5,i(t,{context:this.decodeContext});case 5:if(n=e.sent,r=null,n.numberOfChannels>=2)for(r=new Float32Array(n.length),a=0;a<n.numberOfChannels;a+=1)for(o=n.getChannelData(a),s=0;s<n.length;s+=1)r[s]+=o[s]/n.numberOfChannels;else r=n.getChannelData(0);this.makePrediction(r);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),makePrediction:function(e){var t,n=this,r=function(){var e=n.decodeContext.createBuffer(1,u.length,22050);e.copyToChannel(u,0);var t=new window.Blob([new DataView(f(e))],{type:"audio/wav"}),r=n.decodeContext.createBuffer(1,l.length,22050);r.copyToChannel(l,0);var a=new window.Blob([new DataView(f(r))],{type:"audio/wav"});n.$refs.instrumental.src=URL.createObjectURL(t),n.$refs.voice.src=URL.createObjectURL(a)},o=function(){var f=s()(regeneratorRuntime.mark(function s(){var f,h,p,d,g,w,m,v,y;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(f=tf.tidy(function(){t||(t=tf.keep(tf.tile(tf.range(0,1,1/512).reshape([512,1,1]),[1,64,1])));var e=i.next(),r=e.value;if(e.done)return null;var o=a()(r,2),s=o[0],f=o[1],u=tf.sqrt(tf.add(s.square(),f.square())),l=tf.atan2(f,s),c=[u.reshape([1,512,64,1]),t.expandDims()],h=n.model.predict(c).squeeze([0]),p=tf.mul(h,tf.cos(l).expandDims(2)),d=tf.mul(h,tf.sin(l).expandDims(2)),g=tf.unstack(p,2),w=a()(g,2),m=w[0],v=w[1],y=tf.unstack(d,2),x=a()(y,2),b=x[0],A=x[1];return[n.istftHalf(m,b,{nFft:1023,hopLength:256}),n.istftHalf(v,A,{nFft:1023,hopLength:256})]})){s.next=4;break}return r(),s.abrupt("return");case 4:h=0;case 5:if(!(h<f[0].length)){s.next=14;break}return p=256*(h+64*c),s.next=9,f[0][h].data();case 9:for(d=s.sent,g=0;g<d.length&&p+g<e.length;g+=1)u[p+g]+=d[g];case 11:h+=1,s.next=5;break;case 14:w=0;case 15:if(!(w<f[1].length)){s.next=24;break}return m=256*(w+64*c),s.next=19,f[1][w].data();case 19:for(v=s.sent,y=0;y<v.length&&m+y<e.length;y+=1)l[m+y]+=v[y];case 21:w+=1,s.next=15;break;case 24:return f[0].forEach(function(e){return e.dispose()}),f[1].forEach(function(e){return e.dispose()}),c+=1,s.next=29,tf.nextFrame();case 29:setTimeout(o,0);case 30:case"end":return s.stop()}},s,this)}));return function(){return f.apply(this,arguments)}}(),i=this.stftGenerator(e,{nFft:1023,hopLength:256}),u=new Float32Array(e.length),l=new Float32Array(e.length),c=0;o()},istftHalf:function(e,t){return tf.tidy(function(){for(var n=e.shape[0],r=e.slice(1,n-2).reverse(0),a=t.slice(1,n-2).reverse(0).neg(),o=e.concat(r),s=t.concat(a),i=tf.unstack(o,1),f=tf.unstack(s,1),u=[],l=0;l<i.length;l+=1){var c=tf.complex(i[l],f[l]);u.push(tf.real(tf.ifft(c)).squeeze())}return u})},stftGenerator:regeneratorRuntime.mark(function e(t,n){var r,o,s,i,f,u,l,c,h,p,d,g=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.nFft||2048,o=n.winLength||r,s=n.hopLength||Math.floor(o/4),i=n.sampleSize||64,f=tf.range(0,o),u=tf.keep(tf.mul(.5,tf.sub(1,tf.cos(tf.mul(2*Math.PI/o,f))))),l=[],c=[],h=1+Math.floor(r/2),p=regeneratorRuntime.mark(function e(n){var o,f,p,d,w,m,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n*s,g.progress=Math.floor(o/t.length*100),!((f=t.slice(o,o+r)).length<r)){e.next=5;break}return e.abrupt("return","break");case 5:if(p=tf.tidy(function(){var e=tf.mul(tf.tensor1d(f),u),t=tf.fft(e.asType("complex64")),n=tf.real(t).squeeze(),r=tf.imag(t).squeeze();return[n.slice(0,h),r.slice(0,h)]}),d=a()(p,2),w=d[0],m=d[1],l.push(w),c.push(m),!(l.length>=i)){e.next=16;break}return v=[tf.stack(l,1),tf.stack(c,1)],l.forEach(function(e){return e.dispose()}),c.forEach(function(e){return e.dispose()}),l.length=0,c.length=0,e.next=16,v;case 16:case"end":return e.stop()}},e,this)}),d=0;case 11:return e.delegateYield(p(d),"t0",12);case 12:if("break"!==e.t0){e.next=15;break}return e.abrupt("break",18);case 15:d++,e.next=11;break;case 18:u.dispose();case 19:case"end":return e.stop()}},e,this)})}},l=(n(322),n(23)),c=Object(l.a)(u,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:!e.model,expression:"!model"}],staticClass:"hourglass"},[n("el-row",[n("el-button",{on:{click:function(t){e.$refs.uploader.click()}}},[e._v("\n      打开音频\n    ")]),e._v(" "),n("input",{ref:"uploader",attrs:{type:"file",hidden:""},on:{change:e.handleFileChange}})],1),e._v(" "),n("el-row",[n("el-progress",{attrs:{percentage:e.progress,type:"circle"}})],1),e._v(" "),n("el-row",[n("div",[n("audio",{ref:"instrumental",attrs:{controls:""}})]),e._v(" "),n("div",[n("audio",{ref:"voice",attrs:{controls:""}})])]),e._v(" "),n("el-row",[n("a",{attrs:{href:"http://ismir2018.ircam.fr/doc/pdfs/138_Paper.pdf",target:"_blank"}},[e._v("\n      Music Source Separation Using Stacked Hourglass Networks\n    ")])])],1)},[],!1,null,null,null);c.options.__file="hourglass.vue";t.default=c.exports}}]);